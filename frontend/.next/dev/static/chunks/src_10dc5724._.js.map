{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/DELL/Documents/AEGIS/frontend/src/components/ProtectedRoute.tsx"],"sourcesContent":["\"use client\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useEffect } from \"react\";\r\n\r\ninterface ProtectedRouteProps {\r\n    children: React.ReactNode;\r\n    allowedRoles?: string[];\r\n}\r\n\r\nconst ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children, allowedRoles }) => {\r\n    const { user, loading, role } = useAuth();\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n        if (!loading && !user) {\r\n            router.push(\"/login\");\r\n        } else if (!loading && user && allowedRoles && !allowedRoles.includes(role || 'student')) {\r\n            // Redirect to unauthorized page if role doesn't match\r\n            router.push(\"/unauthorized\");\r\n        }\r\n    }, [user, loading, role, allowedRoles, router]);\r\n\r\n    if (loading) {\r\n        return <div className=\"flex items-center justify-center min-h-screen\">Loading authentication...</div>;\r\n    }\r\n\r\n    // If check fails, returing null prevents flash of content before redirect executes\r\n    if (!user || (allowedRoles && !allowedRoles.includes(role || 'student'))) {\r\n        return null;\r\n    }\r\n\r\n    return <>{children}</>;\r\n};\r\n\r\nexport default ProtectedRoute;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AAUA,MAAM,iBAAgD,CAAC,EAAE,QAAQ,EAAE,YAAY,EAAE;;IAC7E,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,4IAAO;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,IAAA,0KAAS;oCAAC;YACN,IAAI,CAAC,WAAW,CAAC,MAAM;gBACnB,OAAO,IAAI,CAAC;YAChB,OAAO,IAAI,CAAC,WAAW,QAAQ,gBAAgB,CAAC,aAAa,QAAQ,CAAC,QAAQ,YAAY;gBACtF,sDAAsD;gBACtD,OAAO,IAAI,CAAC;YAChB;QACJ;mCAAG;QAAC;QAAM;QAAS;QAAM;QAAc;KAAO;IAE9C,IAAI,SAAS;QACT,qBAAO,6LAAC;YAAI,WAAU;sBAAgD;;;;;;IAC1E;IAEA,mFAAmF;IACnF,IAAI,CAAC,QAAS,gBAAgB,CAAC,aAAa,QAAQ,CAAC,QAAQ,YAAa;QACtE,OAAO;IACX;IAEA,qBAAO;kBAAG;;AACd;GAvBM;;QAC8B,4IAAO;QACxB,kJAAS;;;KAFtB;uCAyBS"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///D:/DELL/Documents/AEGIS/frontend/src/app/faculty/upload/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { storage } from '@/lib/firebase';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nexport default function ResourceUploadPage() {\r\n    const { user, role } = useAuth();\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [formData, setFormData] = useState({\r\n        title: '',\r\n        description: '',\r\n        courseId: '',\r\n        resourceType: 'Notes',\r\n        tags: ''\r\n    });\r\n\r\n    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const selectedFile = e.target.files[0];\r\n            // 50MB Limit\r\n            if (selectedFile.size > 50 * 1024 * 1024) {\r\n                alert('File size exceeds 50MB limit.');\r\n                return;\r\n            }\r\n            setFile(selectedFile);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!file) {\r\n            alert('Please select a file to upload.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n\r\n        try {\r\n            // 1. Upload File to Firebase Storage\r\n            const storageRef = ref(storage, `resources/${Date.now()}_${file.name}`);\r\n            const snapshot = await uploadBytes(storageRef, file);\r\n            const fileUrl = await getDownloadURL(snapshot.ref);\r\n\r\n            // 2. Send Metadata to Backend\r\n            const token = await user?.getIdToken();\r\n            const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api'}/academic/upload`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    ...formData,\r\n                    courseId: formData.courseId.toUpperCase(), // Normalize course codes\r\n                    tags: formData.tags.split(',').map(tag => tag.trim()), // Simple CSV parsing\r\n                    fileUrl\r\n                })\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to upload resource metadata');\r\n\r\n            alert('Resource uploaded successfully!');\r\n            router.push('/dashboard'); // Or back to resources list\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert('Error processing upload. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <ProtectedRoute allowedRoles={['faculty', 'admin']}>\r\n            <div className=\"max-w-2xl mx-auto py-10\">\r\n                <h1 className=\"text-3xl font-bold mb-6 text-gray-900 dark:text-white\">Upload Academic Resource</h1>\r\n                <form onSubmit={handleSubmit} className=\"space-y-6 bg-white dark:bg-gray-800 p-8 rounded-xl shadow-md border border-gray-200 dark:border-gray-700\">\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Title</label>\r\n                        <input type=\"text\" name=\"title\" required value={formData.title} onChange={handleChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 p-2\" placeholder=\"e.g. Data Structures Lecture 1\" />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Course Code</label>\r\n                        <input type=\"text\" name=\"courseId\" required value={formData.courseId} onChange={handleChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 p-2\" placeholder=\"e.g. CS101\" />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Resource Type</label>\r\n                        <select name=\"resourceType\" value={formData.resourceType} onChange={handleChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 p-2\">\r\n                            <option>Notes</option>\r\n                            <option>Paper</option>\r\n                            <option>Slides</option>\r\n                            <option>Assignment</option>\r\n                            <option>Other</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Description</label>\r\n                        <textarea name=\"description\" rows={3} value={formData.description} onChange={handleChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 p-2\"></textarea>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">File Upload (Max 50MB)</label>\r\n                        <input type=\"file\" required onChange={handleFileChange} className=\"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-gray-700 dark:file:text-gray-300\" />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Tags (comma separated)</label>\r\n                        <input type=\"text\" name=\"tags\" value={formData.tags} onChange={handleChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 p-2\" placeholder=\"e.g. recursion, sorting, midterm\" />\r\n                    </div>\r\n\r\n                    <button type=\"submit\" disabled={loading} className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\">\r\n                        {loading ? 'Uploading...' : 'Upload Resource'}\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </ProtectedRoute>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}